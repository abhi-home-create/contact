function doGet(e) {
  return handleRequest(e);
}

function handleRequest(e) {
  try {
    const data = e.parameter;
    
    // Validate required fields
    if (!data.name || !data.email || !data.subject || !data.message) {
      throw new Error('All fields are required');
    }

    // Spreadsheet operations
    const ss = SpreadsheetApp.openById('1TPD-9f07G4-upwi4YE9ynoVuNmXpndK8gwMXLfx7glc');
    const sheet = ss.getActiveSheet();
    
    sheet.appendRow([
      new Date(),
      data.name,
      data.email,
      data.subject,
      data.message
    ]);

    // Create JSONP response
    const response = {
      status: 'success',
      message: 'Form submitted successfully'
    };

    return ContentService.createTextOutput(data.callback + '(' + JSON.stringify(response) + ')')
      .setMimeType(ContentService.MimeType.JAVASCRIPT)
      .setHeader('Access-Control-Allow-Origin', '*');

  } catch(error) {
    const response = {
      status: 'error',
      message: error.toString()
    };
    
    return ContentService.createTextOutput(data.callback + '(' + JSON.stringify(response) + ')')
      .setMimeType(ContentService.MimeType.JAVASCRIPT)
      .setHeader('Access-Control-Allow-Origin', '*');
  }
}